'use client'
import{useState,useEffect}from'react'
import{useRouter}from'next/navigation'
import{useWeb3Auth}from'@/lib/web3auth'
import{Wallet,Copy,Send,LogOut}from'lucide-react'
import{getAddr,getBal,sendTx}from'@/lib/polkadot'
export default function Dashboard(){const r=useRouter();const{provider,isConnected,userInfo,disconnect,loading}=useWeb3Auth();const[addr,setAddr]=useState('');const[bal,setBal]=useState<any>(null);const[copied,setCopied]=useState(false);const[to,setTo]=useState('');const[amt,setAmt]=useState('');const[sending,setSending]=useState(false);useEffect(()=>{if(!loading&&!isConnected)r.push('/');if(provider)load()},[isConnected,loading,provider]);const load=async()=>{if(!provider)return;try{setAddr(await getAddr(provider));setBal(await getBal(provider))}catch(e){}};const send=async()=>{if(!provider||!to||!amt)return;setSending(true);try{await sendTx(provider,to,parseFloat(amt)*1e12);alert('Sent!');setTo('');setAmt('');await load()}catch(e:any){alert('Failed')}setSending(false)};if(loading||!addr)return<div className="min-h-screen flex items-center justify-center"><div className="animate-spin h-8 w-8 border-2 border-blue-500 rounded-full border-t-transparent"/></div>;return<div className="min-h-screen bg-gradient-to-br from-gray-900 to-blue-900"><header className="glass border-b"><div className="container mx-auto px-6 py-4 flex items-center justify-between"><div className="flex items-center space-x-2"><Wallet className="w-6 h-6 text-blue-500"/><span className="text-xl font-bold">ChainAuth</span></div><button onClick={()=>{disconnect();r.push('/')}}className="glass p-2 rounded-lg"><LogOut className="w-5 h-5"/></button></div></header><main className="container mx-auto px-6 py-8 max-w-4xl">{userInfo&&<div className="glass rounded-xl p-6 mb-6"><h2 className="text-2xl font-bold">{userInfo.name||'User'}</h2><p className="text-gray-400">{userInfo.email}</p></div>}<div className="glass rounded-xl p-6 mb-6"><h3 className="text-sm text-gray-400 mb-2">Address</h3><div className="flex gap-2"><code className="flex-1 bg-black/30 px-4 py-3 rounded-lg text-sm">{addr}</code><button onClick={()=>{navigator.clipboard.writeText(addr);setCopied(true);setTimeout(()=>setCopied(false),2000)}}className="glass px-4 rounded-lg">{copied?'âœ“':<Copy className="w-5 h-5"/>}</button></div></div><div className="glass rounded-xl p-6 mb-6"><h3 className="text-sm text-gray-400 mb-2">Balance</h3>{bal?<div className="text-4xl font-bold">{(parseFloat(bal.data.free.replace(/,/g,''))/1e12).toFixed(4)}WND</div>:<div>Loading...</div>}</div><div className="glass rounded-xl p-6"><h3 className="text-xl font-semibold mb-4 flex items-center gap-2"><Send className="w-5 h-5 text-blue-500"/>Send</h3><div className="space-y-4"><input value={to}onChange={(e)=>setTo(e.target.value)}placeholder="Address"className="w-full bg-black/30 border border-gray-700 rounded-lg px-4 py-3"/><input value={amt}onChange={(e)=>setAmt(e.target.value)}placeholder="Amount (WND)"type="number"step="0.0001"className="w-full bg-black/30 border border-gray-700 rounded-lg px-4 py-3"/><button onClick={send}disabled={sending||!to||!amt}className="w-full bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg font-semibold disabled:opacity-50">{sending?'Sending...':'Send'}</button></div></div></main></div>}
